var Xe=Object.create;var J=Object.defineProperty;var et=Object.getOwnPropertyDescriptor;var tt=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var he=n=>J(n,"__esModule",{value:!0});var G=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ot=(n,e)=>{he(n);for(var t in e)J(n,t,{get:e[t],enumerable:!0})},it=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of tt(e))!st.call(n,s)&&s!=="default"&&J(n,s,{get:()=>e[s],enumerable:!(t=et(e,s))||t.enumerable});return n},R=n=>it(he(J(n!=null?Xe(nt(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var ke=G(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});var y=require("obsidian"),oe="YYYY-MM-DD",ie="gggg-[W]ww",me="YYYY-MM",fe="YYYY-[Q]Q",ye="YYYY";function $(n){let e=window.app.plugins.getPlugin("periodic-notes");return e&&e.settings?.[n]?.enabled}function L(){try{let{internalPlugins:n,plugins:e}=window.app;if($("daily")){let{format:i,folder:c,template:u}=e.getPlugin("periodic-notes")?.settings?.daily||{};return{format:i||oe,folder:c?.trim()||"",template:u?.trim()||""}}let{folder:t,format:s,template:o}=n.getPluginById("daily-notes")?.instance?.options||{};return{format:s||oe,folder:t?.trim()||"",template:o?.trim()||""}}catch(n){console.info("No custom daily note settings found!",n)}}function M(){try{let n=window.app.plugins,e=n.getPlugin("calendar")?.options,t=n.getPlugin("periodic-notes")?.settings?.weekly;if($("weekly"))return{format:t.format||ie,folder:t.folder?.trim()||"",template:t.template?.trim()||""};let s=e||{};return{format:s.weeklyNoteFormat||ie,folder:s.weeklyNoteFolder?.trim()||"",template:s.weeklyNoteTemplate?.trim()||""}}catch(n){console.info("No custom weekly note settings found!",n)}}function _(){let n=window.app.plugins;try{let e=$("monthly")&&n.getPlugin("periodic-notes")?.settings?.monthly||{};return{format:e.format||me,folder:e.folder?.trim()||"",template:e.template?.trim()||""}}catch(e){console.info("No custom monthly note settings found!",e)}}function U(){let n=window.app.plugins;try{let e=$("quarterly")&&n.getPlugin("periodic-notes")?.settings?.quarterly||{};return{format:e.format||fe,folder:e.folder?.trim()||"",template:e.template?.trim()||""}}catch(e){console.info("No custom quarterly note settings found!",e)}}function H(){let n=window.app.plugins;try{let e=$("yearly")&&n.getPlugin("periodic-notes")?.settings?.yearly||{};return{format:e.format||ye,folder:e.folder?.trim()||"",template:e.template?.trim()||""}}catch(e){console.info("No custom yearly note settings found!",e)}}function be(...n){let e=[];for(let s=0,o=n.length;s<o;s++)e=e.concat(n[s].split("/"));let t=[];for(let s=0,o=e.length;s<o;s++){let i=e[s];!i||i==="."||t.push(i)}return e[0]===""&&t.unshift(""),t.join("/")}function rt(n){let e=n.substring(n.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function at(n){let e=n.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let t=be(...e);window.app.vault.getAbstractFileByPath(t)||await window.app.vault.createFolder(t)}}async function Y(n,e){e.endsWith(".md")||(e+=".md");let t=y.normalizePath(be(n,e));return await at(t),t}async function v(n){let{metadataCache:e,vault:t}=window.app,s=y.normalizePath(n);if(s==="/")return Promise.resolve(["",null]);try{let o=e.getFirstLinkpathDest(s,""),i=await t.cachedRead(o),c=window.app.foldManager.load(o);return[i,c]}catch(o){return console.error(`Failed to read the daily note template '${s}'`,o),new y.Notice("Failed to read the daily note template"),["",null]}}function S(n,e="day"){let t=n.clone().startOf(e).format();return`${e}-${t}`}function we(n){return n.replace(/\[[^\]]*\]/g,"")}function lt(n,e){if(e==="week"){let t=we(n);return/w{1,2}/i.test(t)&&(/M{1,4}/.test(t)||/D{1,4}/.test(t))}return!1}function O(n,e){return Pe(n.basename,e)}function ct(n,e){return Pe(rt(n),e)}function Pe(n,e){let s={day:L,week:M,month:_,quarter:U,year:H}[e]().format.split("/").pop(),o=window.moment(n,s,!0);if(!o.isValid())return null;if(lt(s,e)&&e==="week"){let i=we(s);if(/w{1,2}/i.test(i))return window.moment(n,s.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return o}var Ce=class extends Error{};async function Se(n){let e=window.app,{vault:t}=e,s=window.moment,{template:o,format:i,folder:c}=L(),[u,g]=await v(o),l=n.format(i),a=await Y(c,l);try{let r=await t.create(a,u.replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,s().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,b,C,f,h,m)=>{let F=s(),I=n.clone().set({hour:F.get("hour"),minute:F.get("minute"),second:F.get("second")});return C&&I.add(parseInt(f,10),h),m?I.format(m.substring(1).trim()):I.format(i)}).replace(/{{\s*yesterday\s*}}/gi,n.clone().subtract(1,"day").format(i)).replace(/{{\s*tomorrow\s*}}/gi,n.clone().add(1,"d").format(i)));return e.foldManager.save(r,g),r}catch(r){console.error(`Failed to create file: '${a}'`,r),new y.Notice("Unable to create new file.")}}function ut(n,e){return e[S(n,"day")]??null}function dt(){let{vault:n}=window.app,{folder:e}=L(),t=n.getAbstractFileByPath(y.normalizePath(e));if(!t)throw new Ce("Failed to find daily notes folder");let s={};return y.Vault.recurseChildren(t,o=>{if(o instanceof y.TFile){let i=O(o,"day");if(i){let c=S(i,"day");s[c]=o}}}),s}var Ne=class extends Error{};function pt(){let{moment:n}=window,e=n.localeData()._week.dow,t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)t.push(t.shift()),e--;return t}function gt(n){return pt().indexOf(n.toLowerCase())}async function Fe(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=M(),[i,c]=await v(t),u=n.format(s),g=await Y(o,u);try{let l=await e.create(g,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(a,r,d,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return d&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*title\s*}}/gi,u).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(a,r,d)=>{let b=gt(r);return n.weekday(b).format(d.trim())}));return window.app.foldManager.save(l,c),l}catch(l){console.error(`Failed to create file: '${g}'`,l),new y.Notice("Unable to create new file.")}}function ht(n,e){return e[S(n,"week")]??null}function mt(){let n={};if(!De())return n;let{vault:e}=window.app,{folder:t}=M(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new Ne("Failed to find weekly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let i=O(o,"week");if(i){let c=S(i,"week");n[c]=o}}}),n}var Ee=class extends Error{};async function Te(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=_(),[i,c]=await v(t),u=n.format(s),g=await Y(o,u);try{let l=await e.create(g,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(a,r,d,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return d&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*date\s*}}/gi,u).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,u));return window.app.foldManager.save(l,c),l}catch(l){console.error(`Failed to create file: '${g}'`,l),new y.Notice("Unable to create new file.")}}function ft(n,e){return e[S(n,"month")]??null}function yt(){let n={};if(!xe())return n;let{vault:e}=window.app,{folder:t}=_(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new Ee("Failed to find monthly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let i=O(o,"month");if(i){let c=S(i,"month");n[c]=o}}}),n}var ve=class extends Error{};async function bt(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=U(),[i,c]=await v(t),u=n.format(s),g=await Y(o,u);try{let l=await e.create(g,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(a,r,d,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return d&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*date\s*}}/gi,u).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,u));return window.app.foldManager.save(l,c),l}catch(l){console.error(`Failed to create file: '${g}'`,l),new y.Notice("Unable to create new file.")}}function wt(n,e){return e[S(n,"quarter")]??null}function Pt(){let n={};if(!Ae())return n;let{vault:e}=window.app,{folder:t}=U(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new ve("Failed to find quarterly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let i=O(o,"quarter");if(i){let c=S(i,"quarter");n[c]=o}}}),n}var Oe=class extends Error{};async function Ct(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=H(),[i,c]=await v(t),u=n.format(s),g=await Y(o,u);try{let l=await e.create(g,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(a,r,d,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return d&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*date\s*}}/gi,u).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,u));return window.app.foldManager.save(l,c),l}catch(l){console.error(`Failed to create file: '${g}'`,l),new y.Notice("Unable to create new file.")}}function St(n,e){return e[S(n,"year")]??null}function Nt(){let n={};if(!qe())return n;let{vault:e}=window.app,{folder:t}=H(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new Oe("Failed to find yearly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let i=O(o,"year");if(i){let c=S(i,"year");n[c]=o}}}),n}function Ft(){let{app:n}=window,e=n.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let t=n.plugins.getPlugin("periodic-notes");return t&&t.settings?.daily?.enabled}function De(){let{app:n}=window;if(n.plugins.getPlugin("calendar"))return!0;let e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.weekly?.enabled}function xe(){let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.monthly?.enabled}function Ae(){let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.quarterly?.enabled}function qe(){let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.yearly?.enabled}function Et(n){return{day:L,week:M,month:_,quarter:U,year:H}[n]()}function Tt(n,e){return{day:Se,month:Te,week:Fe}[n](e)}p.DEFAULT_DAILY_NOTE_FORMAT=oe;p.DEFAULT_MONTHLY_NOTE_FORMAT=me;p.DEFAULT_QUARTERLY_NOTE_FORMAT=fe;p.DEFAULT_WEEKLY_NOTE_FORMAT=ie;p.DEFAULT_YEARLY_NOTE_FORMAT=ye;p.appHasDailyNotesPluginLoaded=Ft;p.appHasMonthlyNotesPluginLoaded=xe;p.appHasQuarterlyNotesPluginLoaded=Ae;p.appHasWeeklyNotesPluginLoaded=De;p.appHasYearlyNotesPluginLoaded=qe;p.createDailyNote=Se;p.createMonthlyNote=Te;p.createPeriodicNote=Tt;p.createQuarterlyNote=bt;p.createWeeklyNote=Fe;p.createYearlyNote=Ct;p.getAllDailyNotes=dt;p.getAllMonthlyNotes=yt;p.getAllQuarterlyNotes=Pt;p.getAllWeeklyNotes=mt;p.getAllYearlyNotes=Nt;p.getDailyNote=ut;p.getDailyNoteSettings=L;p.getDateFromFile=O;p.getDateFromPath=ct;p.getDateUID=S;p.getMonthlyNote=ft;p.getMonthlyNoteSettings=_;p.getPeriodicNoteSettings=Et;p.getQuarterlyNote=wt;p.getQuarterlyNoteSettings=U;p.getTemplateInfo=v;p.getWeeklyNote=ht;p.getWeeklyNoteSettings=M;p.getYearlyNote=St;p.getYearlyNoteSettings=H});var Le=G((nn,$e)=>{var D=1e3,x=D*60,A=x*60,T=A*24,kt=T*7,It=T*365.25;$e.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Rt(n);if(t==="number"&&isFinite(n))return e.long?Lt(n):$t(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Rt(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!!e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*It;case"weeks":case"week":case"w":return t*kt;case"days":case"day":case"d":return t*T;case"hours":case"hour":case"hrs":case"hr":case"h":return t*A;case"minutes":case"minute":case"mins":case"min":case"m":return t*x;case"seconds":case"second":case"secs":case"sec":case"s":return t*D;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function $t(n){var e=Math.abs(n);return e>=T?Math.round(n/T)+"d":e>=A?Math.round(n/A)+"h":e>=x?Math.round(n/x)+"m":e>=D?Math.round(n/D)+"s":n+"ms"}function Lt(n){var e=Math.abs(n);return e>=T?Z(n,e,T,"day"):e>=A?Z(n,e,A,"hour"):e>=x?Z(n,e,x,"minute"):e>=D?Z(n,e,D,"second"):n+" ms"}function Z(n,e,t,s){var o=e>=t*1.5;return Math.round(n/t)+" "+s+(o?"s":"")}});var _e=G((sn,Me)=>{function Mt(n){t.debug=t,t.default=t,t.coerce=g,t.disable=i,t.enable=o,t.enabled=c,t.humanize=Le(),t.destroy=l,Object.keys(n).forEach(a=>{t[a]=n[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let r=0;for(let d=0;d<a.length;d++)r=(r<<5)-r+a.charCodeAt(d),r|=0;return t.colors[Math.abs(r)%t.colors.length]}t.selectColor=e;function t(a){let r,d=null,b,C;function f(...h){if(!f.enabled)return;let m=f,F=Number(new Date),I=F-(r||F);m.diff=I,m.prev=r,m.curr=F,r=F,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let B=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(se,Ke)=>{if(se==="%%")return"%";B++;let ge=t.formatters[Ke];if(typeof ge=="function"){let Ze=h[B];se=ge.call(m,Ze),h.splice(B,1),B--}return se}),t.formatArgs.call(m,h),(m.log||t.log).apply(m,h)}return f.namespace=a,f.useColors=t.useColors(),f.color=t.selectColor(a),f.extend=s,f.destroy=t.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(b!==t.namespaces&&(b=t.namespaces,C=t.enabled(a)),C),set:h=>{d=h}}),typeof t.init=="function"&&t.init(f),f}function s(a,r){let d=t(this.namespace+(typeof r=="undefined"?":":r)+a);return d.log=this.log,d}function o(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let r,d=(typeof a=="string"?a:"").split(/[\s,]+/),b=d.length;for(r=0;r<b;r++)!d[r]||(a=d[r].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function i(){let a=[...t.names.map(u),...t.skips.map(u).map(r=>"-"+r)].join(",");return t.enable(""),a}function c(a){if(a[a.length-1]==="*")return!0;let r,d;for(r=0,d=t.skips.length;r<d;r++)if(t.skips[r].test(a))return!1;for(r=0,d=t.names.length;r<d;r++)if(t.names[r].test(a))return!0;return!1}function u(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function g(a){return a instanceof Error?a.stack||a.message:a}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Me.exports=Mt});var ae=G((P,X)=>{P.formatArgs=Ut;P.save=Ht;P.load=Yt;P.useColors=_t;P.storage=jt();P.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function _t(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ut(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+X.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,s=0;n[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(s=t))}),n.splice(s,0,e)}P.log=console.debug||console.log||(()=>{});function Ht(n){try{n?P.storage.setItem("debug",n):P.storage.removeItem("debug")}catch(e){}}function Yt(){let n;try{n=P.storage.getItem("debug")}catch(e){}return!n&&typeof process!="undefined"&&"env"in process&&(n=process.env.DEBUG),n}function jt(){try{return localStorage}catch(n){}}X.exports=_e()(P);var{formatters:Qt}=X.exports;Qt.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});ot(exports,{default:()=>pe});var z=R(require("obsidian")),k=R(ke());var Ie=R(require("obsidian")),K=class extends Ie.Modal{constructor(e,t){super(e);this.config=t;let{cta:s,onAccept:o,text:i,title:c}=t;this.contentEl.createEl("h2",{text:c}),this.contentEl.createEl("p",{text:i}),this.contentEl.createEl("button",{text:"Never mind"}).addEventListener("click",()=>{this.close()}),this.contentEl.createEl("button",{cls:"mod-cta",text:s}).addEventListener("click",async u=>{this.accepted=!0,this.close(),setTimeout(()=>o(u),20)})}onClose(){var e,t;this.accepted||(t=(e=this.config).onCancel)==null||t.call(e)}};var N=R(require("obsidian")),vt="## Pinboard",Ot=30*60,Dt="pinboard/",xt="Username:SecretTokenCode",At=20,qt="pinboard/",Re=Object.freeze({apiToken:xt,hasAcceptedDisclaimer:!1,latestSyncTime:0,isSyncEnabled:!1,syncInterval:Ot,sectionHeading:vt,tagPrefix:Dt,recentCount:At,oneNotePerPin:!1,oneNotePerPinPath:qt}),re=class extends N.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){this.containerEl.empty(),this.containerEl.createEl("h3",{text:"Pinboard"}),this.addApiTokenSetting(),this.containerEl.createEl("h3",{text:"Structure"}),this.addOneNotePerPinSetting(),this.addOneNotePerPinPathSetting(),this.containerEl.createEl("h3",{text:"Format"}),this.addSectionHeadingSetting(),this.addTagPrefixSetting(),this.containerEl.createEl("h3",{text:"Sync"}),this.addSyncEnabledSetting(),this.addSyncIntervalSetting(),this.addRecentCountSetting()}addApiTokenSetting(){new N.Setting(this.containerEl).setName("Token").setDesc("Pinboard API Token").addText(e=>{e.setValue(this.plugin.settings.apiToken),e.onChange(async t=>{let s=t.trim();this.plugin.writeSettings({apiToken:s})})})}addOneNotePerPinSetting(){new N.Setting(this.containerEl).setName("One note per pin").setDesc("When enabled, syncing will create a new note per pin").addToggle(e=>{e.setValue(this.plugin.settings.oneNotePerPin),e.onChange(t=>{this.plugin.writeSettings({oneNotePerPin:t})})})}addOneNotePerPinPathSetting(){new N.Setting(this.containerEl).setName("One note per pin path").setDesc("The path to store pins in when using the one note per pin setting").addText(e=>{e.setValue(this.plugin.settings.oneNotePerPinPath),e.inputEl.onblur=t=>{let s=t.target.value;e.setValue(s),this.plugin.writeSettings({oneNotePerPinPath:s})}})}addRecentCountSetting(){new N.Setting(this.containerEl).setName("Recent Posts").setDesc("Number of recent posts the plugin will read to sync").addText(e=>{e.setValue(String(this.plugin.settings.recentCount)),e.inputEl.type="number",e.inputEl.onblur=t=>{let s=Number(t.target.value);e.setValue(String(s)),this.plugin.writeSettings({recentCount:s})}})}addSectionHeadingSetting(){new N.Setting(this.containerEl).setName("Section heading").setDesc("Markdown heading to use when adding the Pinboard links to a daily note").addText(e=>{e.setValue(this.plugin.settings.sectionHeading),e.onChange(async t=>{let s=t.trim();this.plugin.writeSettings({sectionHeading:s})})})}addSyncEnabledSetting(){new N.Setting(this.containerEl).setName("Enable periodic syncing").addToggle(e=>{e.setValue(this.plugin.settings.isSyncEnabled),e.onChange(async t=>{this.plugin.writeSettings({isSyncEnabled:t})})})}addSyncIntervalSetting(){new N.Setting(this.containerEl).setName("Sync Frequency").setDesc("Number of seconds the plugin will wait before syncing again").addText(e=>{e.setValue(String(this.plugin.settings.syncInterval)),e.inputEl.type="number",e.inputEl.onblur=t=>{let s=Number(t.target.value);e.setValue(String(s)),this.plugin.writeSettings({syncInterval:s})}})}addTagPrefixSetting(){new N.Setting(this.containerEl).setName("Tag Prefix").setDesc("Prefix added to Pinboard tags when imported into Obsidian (e.g. #pinboard/work)").addText(e=>{e.setValue(this.plugin.settings.tagPrefix),e.onChange(async t=>{this.plugin.writeSettings({tagPrefix:t})})})}};var Vt=require("http"),Wt=require("https"),zt=ae(),Ue=zt("shr"),w=class{constructor(e){this.name=e.noEncodeName?e.name:encodeURIComponent(e.name),this.value=e.noEncodeValue?e.value:encodeURIComponent(e.value)}clone(){return new w({name:this.name,value:this.value,noEncodeName:!0,noEncodeValue:!0})}},q=class{constructor(e){this.host=e.host,this.basePath=e.basePath,this.protocol=typeof e.protocol!="undefined"?e.protocol:"https:",this.port=typeof e.port!="undefined"?e.port:443,this.parseJson=typeof e.parseJson!="undefined"?e.parseJson:!1,this.queryParams=typeof e.queryParams!="undefined"?e.queryParams:[],this.method=typeof e.method!="undefined"?e.method:"GET",this.postData=typeof e.postData!="undefined"?e.postData:""}get path(){return`/${this.basePath.join("/")}${this.urlParametersString}`}get urlParametersString(){let e="";return this.queryParams.forEach(t=>{e.length===0?e+="?":e+="&",e+=`${t.name}=${t.value}`}),e}get fullUrl(){return`${this.protocol}//${this.host}:${this.port}${this.path}`}clone(e){let t=new q({host:this.host,basePath:[],protocol:this.protocol,port:this.port,parseJson:this.parseJson,queryParams:[],method:this.method,postData:this.postData});return this.basePath.forEach(s=>t.basePath.push(s)),this.queryParams.forEach(s=>t.queryParams.push(s.clone())),e&&e.subPath&&e.subPath.forEach(s=>t.basePath.push(s)),e&&e.appendQueryParams&&e.appendQueryParams.forEach(s=>t.queryParams.push(s.clone())),t}equals(e){return this.path===e.path&&this.parseJson===e.parseJson&&this.method===e.method&&this.postData===e.postData}get nodeRequestOpts(){return{host:this.host,path:this.path,protocol:this.protocol,port:this.port,method:this.method}}},j=class{req(e){return Ue(`${e.method} ${e.fullUrl}`),new Promise((t,s)=>{let o=!1,i=e.nodeRequestOpts,c=[],u;if(e.protocol==="https:")u=Wt.request(i);else if(e.protocol==="http:")u=Vt.request(i);else throw new Error(`Unknown protocol ${e.protocol}`);u.on("response",g=>{g.statusCode?(g.statusCode<200||g.statusCode>=300)&&(o=!0):Ue("Got a response from the webserver that has no .statusCode property"),g.on("data",l=>c.push(l)),g.on("end",()=>{let l=Buffer.concat(c).toString(),a,r;if(r=l,o)a=new Error(`ERROR ${g.statusCode} when attempting to ${e.method} '${e.fullUrl}'\r
${l}`);else if(e.parseJson)try{r=JSON.parse(l)}catch(d){a=new Error(`JSON Parse error: ${d} when receiving code ${g.statusCode} after performing ${e.method} on '${e.fullUrl}' and attempting to parse body:\r
${l}`)}a?s(a):t(r)})}),u.on("error",g=>s(g)),e.postData&&u.write(e.postData),u.end()})}};var Bt=ae(),Q=Bt("pbsdk"),E=class{static boolean(e){if(e==="yes"||e==="true"||e===1)return!0;if(e==="no"||e==="false"||e===0)return!1;throw`Unable to parse '${e}'`}static dateFormatter(e){return e.toISOString()}},le=class{constructor(e,t){this.name=e;t&&(this.count=t)}},ee=class{constructor(e,t,s,o,i,c,u,g,l=[]){this.href=e;this.description=t;this.extended=s;this.meta=o;this.hash=i;this.time=c;this.shared=u;this.toread=g;this.tags=l}static fromObj(e){let t=new ee(e.href,e.description,e.extended,e.meta,e.hash,new Date(e.time),E.boolean(e.shared),E.boolean(e.toread));return e.tags.split(" ").forEach(s=>t.tags.push(new le(s))),t}uiString(){let e=[];this.tags.forEach(s=>e.push(s.name));let t="";return t+=`----------------
`,t+=this.description?`${this.description}
`:`UNTITLED BOOKMARK
`,t+=`<${this.href}>
`,t+=this.extended?`${this.extended}
`:"",t+=`bookmarked: ${E.dateFormatter(this.time)}
`,t+=`public: ${this.shared}, toread: ${this.toread}
`,t+=`tags: ${e.join(" ")}
`,t+=`----------------
`,t}},V=class{constructor(e,t,s=[]){this.date=e;this.user=t;this.posts=s}uiString(){let e=`PinboardPostCollection for user ${this.user} on ${E.dateFormatter(this.date)}
`;return e+=`================

`,this.posts.forEach(t=>e+=`${t.uiString()}
`),e+=`================
`,e}static fromHttpResponse(e){let t=new V(new Date(e.date),e.user);return e.posts.forEach(s=>t.posts.push(ee.fromObj(s))),Q(`Got a PostCollection with ${t.posts.length} posts`),t}},W=class{constructor(e,t,s,o,i,c){this.id=e;this.title=t;this.createDate=s;this.updateDate=o;this.hash=i;this.text=c}static fromHttpResponse(e){return new W(e.id,e.title,new Date(e.created_at),new Date(e.updated_at),e.text?e.text:"",e.hash)}},He=class{constructor(e,t){this.note=e;this.post=t}uiString(){let e=[];this.post.tags.forEach(s=>e.push(s.name));let t="";return t+=`----------------
`,t+=`Note: ${this.note.title} (id ${this.note.id}
`,t+=`${this.note.text}
`,t+=`added: ${E.dateFormatter(this.note.createDate)} `,t+=`updated: ${E.dateFormatter(this.note.updateDate)}
`,t+=`public: ${this.post.shared}`,t+=`tags: ${e.join(" ")}
`,t+=`----------------
`,t}},Ye=class{constructor(e,t=new j){this.request=t;this.noun="posts";this.urlOpts=e.clone({subPath:[this.noun]})}update(){let e=this.urlOpts.clone({subPath:["update"]});return this.request.req(e).then(t=>(Q(`Last update time: ${t.update_time}`),new Date(t.update_time)))}get(e=[],t,s,o=!1){if(e.length>3)throw"Only three tags are supported for this request";let i=this.urlOpts.clone({subPath:["get"]});return e.forEach(c=>{i.queryParams.push(new w({name:"tag",value:c}))}),t&&i.queryParams.push(new w({name:"dt",value:E.dateFormatter(t)})),s&&i.queryParams.push(new w({name:"url",value:s})),i.queryParams.push(new w({name:"meta",value:o?"yes":"no"})),this.request.req(i).then(c=>V.fromHttpResponse(c))}recent(e=[],t){if(e.length>3)throw"Only three tags are supported for this request";if(typeof t!="undefined"&&(t>100||t<0))throw`Invalid value for 'count': '${t}'. Must be between 0-100.`;let s=this.urlOpts.clone({subPath:["recent"]});return e.forEach(o=>{s.queryParams.push(new w({name:"tag",value:o}))}),t&&s.queryParams.push(new w({name:"count",value:String(t)})),this.request.req(s).then(o=>V.fromHttpResponse(o))}},je=class{constructor(e,t=new j){this.request=t;this.noun="tags";this.urlOpts=e.clone({subPath:[this.noun]})}get(){let e=this.urlOpts.clone({subPath:["get"]});return this.request.req(e).then(t=>{let s=[];for(let o in t)s.push(new le(o,t[o]));return Q(`Got ${s.length} tags`),s})}rename(e,t){let s=this.urlOpts.clone({subPath:["rename"]});return s.queryParams.push(new w({name:"old",value:e})),s.queryParams.push(new w({name:"new",value:t})),this.request.req(s).then(o=>(Q(`Got result: ${o}`),o))}},Qe=class{constructor(e,t=new j){this.request=t;this.noun="notes";this.urlOpts=e.clone({subPath:[this.noun]})}list(){let e=this.urlOpts.clone({subPath:["list"]});return this.request.req(e).then(t=>{let s=[];return t.notes.forEach(o=>s.push(W.fromHttpResponse(o))),s})}get(e){if(e.length<1)throw"An empty string is an invalid noteid.";let t=this.urlOpts.clone({subPath:[e]});return this.request.req(t).then(s=>W.fromHttpResponse(s))}},Ve=class{constructor(e,t,s){this.notesEndpoint=e;this.postsEndpoint=t;this.notesUrlOpts=s}postFromNote(e){let t=this.notesUrlOpts.clone({subPath:[e.id]}).fullUrl;return this.postsEndpoint.get(void 0,void 0,t).then(s=>{if(s.posts.length!=1)throw`Expected to find bookmark for URL ${t}, but found ${s.posts.length} instead.`;return new He(e,s.posts[0])})}list(){return this.notesEndpoint.list().then(e=>{let t=[];return e.forEach(s=>t.push(this.get(s.id))),Promise.all(t)})}get(e){return this.notesEndpoint.get(e).then(t=>this.postFromNote(t))}},te=class{constructor(e,t){this.user=e;this.secret=t;if(e.length<1||t.length<1)throw"Invalid API token string"}toString(){return`${this.user}${te.separator}${this.secret}`}static fromString(e){let t=e.split(this.separator),[s,o]=t;if(t.length!=2)throw"Invalid API token string";return new te(s,o)}},ce=te;ce.separator=":";var ue=class{constructor(e,t=new q({host:"api.pinboard.in",basePath:["v1"]}),s=new q({host:"notes.pinboard.in",basePath:[]})){this.baseUrlOpts=t;this.notesUrlOpts=s;this.apiToken=ce.fromString(e),this.baseUrlOpts.queryParams.push(new w({name:"auth_token",value:this.apiToken.toString(),noEncodeValue:!0}),new w({name:"format",value:"json"})),this.baseUrlOpts.parseJson=!0,this.notesUrlOpts.basePath.push(`u:${this.apiToken.user}`),this.posts=new Ye(this.baseUrlOpts),this.tags=new je(this.baseUrlOpts),this.notes=new Qe(this.baseUrlOpts),this.notePosts=new Ve(this.notes,this.posts,this.notesUrlOpts),Q(`Pinboard object for user ${this.apiToken.user} set up`)}};var We=R(require("obsidian"));function ze(n,e){let t=null;return n.workspace.iterateAllLeaves(s=>{s.view instanceof We.MarkdownView&&s.view.file===e&&(t=s.view.sourceMode.cmEditor)}),t}function ne(n=""){let e=n.match(/^(#{1,6})\s+\S/);return e?e[1].length:null}function Be(n,e){return n?"	":"".padStart(e," ")}function Je(n,e){return n.reduce((t,s)=>{let o=e(s);return t[o]=t[o]||[],t[o].push(s),t},{})}async function Ge(n,e,t,s){let o=ne(t),{vault:i}=n,u=(await i.read(e)).split(`
`),g=-1,l=-1;for(let r=0;r<u.length;r++)if(u[r].trim()===t)g=r;else if(g!==-1){let d=ne(u[r]);if(d&&d<=o){l=r;break}}let a=ze(n,e);if(a)if(g!==-1){let r={line:g,ch:0},d=l!==-1?{line:l-1,ch:0}:{line:u.length,ch:0};a.replaceRange(`${s}
`,r,d);return}else{let r={line:u.length-1,ch:0};a.replaceRange(`

${s}`,r,r);return}if(g!==-1){let r=u.slice(0,g),d=l!==-1?u.slice(l):[];return i.modify(e,[...r,s,...d].join(`
`))}else return i.modify(e,[...u,"",s].join(`
`))}var de=class{constructor(e,t){this.app=e,this.settings=t,this.renderPin=this.renderPin.bind(this)}renderPin(e){let t=this.app.vault,s=Be(t.getConfig("useTab"),t.getConfig("tabSize")),o=this.settings.tagPrefix,i=[];e.tags.forEach(l=>i.push(l.name));let c=i.filter(l=>!!l).map(l=>l.replace(/\s+/g,"-").toLowerCase()).map(l=>`#${o}${l}`).join(" "),u=e.extended;return`- [${e.description}](${e.href}) ${u} ${c}`.trimEnd()}render(e){let{sectionHeading:t}=this.settings,s=ne(t),o=[t];return o.push(...e.map(this.renderPin)),o.join(`
`)}};var pe=class extends z.Plugin{async onload(){console.log("[Pinboard] loading plugin"),this.scheduleNextSync=this.scheduleNextSync.bind(this),this.syncPinboard=this.syncPinboard.bind(this),this.tryToScheduleSync=this.tryToScheduleSync.bind(this),this.tryToSyncPinboard=this.tryToSyncPinboard.bind(this),this.addCommand({id:"pinboard-sync-cmd",name:"Sync",callback:()=>setTimeout(this.tryToSyncPinboard,20)}),await this.loadSettings(),this.settingsTab=new re(this.app,this),this.addSettingTab(this.settingsTab),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onunload(){console.log("[Pinboard] unloading plugin")}async onLayoutReady(){this.settings.hasAcceptedDisclaimer&&this.settings.isSyncEnabled&&this.scheduleNextSync()}async tryToSyncPinboard(){this.settings.hasAcceptedDisclaimer?this.syncPinboard():new K(this.app,{cta:"Sync",onAccept:async()=>{await this.writeSettings({hasAcceptedDisclaimer:!0}),this.syncPinboard()},text:"Enabling sync will backfill your recent Pinboard into Obsidian. This means potentially creating or modifying hundreds of notes. Make sure to test the plugin in a test vault before continuing.",title:"Sync Now?"}).open()}async tryToScheduleSync(){this.settings.hasAcceptedDisclaimer?this.scheduleNextSync():new K(this.app,{cta:"Sync",onAccept:async()=>{await this.writeSettings({hasAcceptedDisclaimer:!0}),this.scheduleNextSync()},onCancel:async()=>{await this.writeSettings({isSyncEnabled:!1}),this.settingsTab.display()},text:"Enabling sync will backfill your recent Pinboard into Obsidian. This means potentially creating or modifying hundreds of notes. Make sure to test the plugin in a test vault before continuing.",title:"Sync Now?"}).open()}async getPostsFromPinboard(e,t){return new ue(t.apiToken).posts.recent([],t.recentCount)}async syncPinboard(){let e=new de(this.app,this.settings),t=(0,k.getAllDailyNotes)(),s=this.settings.latestSyncTime||0,o=[];try{o=await this.getPostsFromPinboard(s,this.settings)}catch(c){new z.Notice("[Pinboard Sync] failed"),console.log(c);return}let i=Je(o.posts.filter(c=>c.time),c=>window.moment(c.time).startOf("day").format());for(let[c,u]of Object.entries(i)){let g=window.moment(c),l=(0,k.getDailyNote)(g,t);l||(l=await(0,k.createDailyNote)(g)),await Ge(this.app,l,this.settings.sectionHeading,e.render(u))}new z.Notice("[Pinboard Sync] complete"),this.writeSettings({latestSyncTime:window.moment().unix()}),this.scheduleNextSync()}cancelScheduledSync(){this.syncTimeoutId!==void 0&&window.clearTimeout(this.syncTimeoutId)}scheduleNextSync(){let e=window.moment().unix();if(this.cancelScheduledSync(),!this.settings.isSyncEnabled||!this.settings.syncInterval){console.log("[Pinboard] scheduling skipped, no syncInterval set");return}let{latestSyncTime:t,syncInterval:s}=this.settings,o=s*1e3,i=Math.max(t+o-e,20);console.log(`[Pinboard] next sync scheduled in ${i}ms`),this.syncTimeoutId=window.setTimeout(this.syncPinboard,i)}async loadSettings(){this.settings=Object.assign({},Re,await this.loadData()),this.settings.hasAcceptedDisclaimer||(this.settings.isSyncEnabled=!1)}async writeSettings(e){this.settings=Object.assign(this.settings,e),e.isSyncEnabled!==void 0?e.isSyncEnabled?this.tryToScheduleSync():this.cancelScheduledSync():e.syncInterval!==void 0&&this.settings.isSyncEnabled&&this.tryToScheduleSync(),await this.saveData(this.settings)}};0&&(module.exports={});
