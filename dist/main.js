var Xe=Object.create;var J=Object.defineProperty;var et=Object.getOwnPropertyDescriptor;var tt=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var he=n=>J(n,"__esModule",{value:!0});var G=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ot=(n,e)=>{he(n);for(var t in e)J(n,t,{get:e[t],enumerable:!0})},rt=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of tt(e))!st.call(n,s)&&s!=="default"&&J(n,s,{get:()=>e[s],enumerable:!(t=et(e,s))||t.enumerable});return n},R=n=>rt(he(J(n!=null?Xe(nt(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var ke=G(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});var y=require("obsidian"),oe="YYYY-MM-DD",re="gggg-[W]ww",me="YYYY-MM",fe="YYYY-[Q]Q",ye="YYYY";function $(n){let e=window.app.plugins.getPlugin("periodic-notes");return e&&e.settings?.[n]?.enabled}function L(){try{let{internalPlugins:n,plugins:e}=window.app;if($("daily")){let{format:r,folder:l,template:c}=e.getPlugin("periodic-notes")?.settings?.daily||{};return{format:r||oe,folder:l?.trim()||"",template:c?.trim()||""}}let{folder:t,format:s,template:o}=n.getPluginById("daily-notes")?.instance?.options||{};return{format:s||oe,folder:t?.trim()||"",template:o?.trim()||""}}catch(n){console.info("No custom daily note settings found!",n)}}function M(){try{let n=window.app.plugins,e=n.getPlugin("calendar")?.options,t=n.getPlugin("periodic-notes")?.settings?.weekly;if($("weekly"))return{format:t.format||re,folder:t.folder?.trim()||"",template:t.template?.trim()||""};let s=e||{};return{format:s.weeklyNoteFormat||re,folder:s.weeklyNoteFolder?.trim()||"",template:s.weeklyNoteTemplate?.trim()||""}}catch(n){console.info("No custom weekly note settings found!",n)}}function U(){let n=window.app.plugins;try{let e=$("monthly")&&n.getPlugin("periodic-notes")?.settings?.monthly||{};return{format:e.format||me,folder:e.folder?.trim()||"",template:e.template?.trim()||""}}catch(e){console.info("No custom monthly note settings found!",e)}}function _(){let n=window.app.plugins;try{let e=$("quarterly")&&n.getPlugin("periodic-notes")?.settings?.quarterly||{};return{format:e.format||fe,folder:e.folder?.trim()||"",template:e.template?.trim()||""}}catch(e){console.info("No custom quarterly note settings found!",e)}}function H(){let n=window.app.plugins;try{let e=$("yearly")&&n.getPlugin("periodic-notes")?.settings?.yearly||{};return{format:e.format||ye,folder:e.folder?.trim()||"",template:e.template?.trim()||""}}catch(e){console.info("No custom yearly note settings found!",e)}}function be(...n){let e=[];for(let s=0,o=n.length;s<o;s++)e=e.concat(n[s].split("/"));let t=[];for(let s=0,o=e.length;s<o;s++){let r=e[s];!r||r==="."||t.push(r)}return e[0]===""&&t.unshift(""),t.join("/")}function it(n){let e=n.substring(n.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function at(n){let e=n.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let t=be(...e);window.app.vault.getAbstractFileByPath(t)||await window.app.vault.createFolder(t)}}async function Y(n,e){e.endsWith(".md")||(e+=".md");let t=y.normalizePath(be(n,e));return await at(t),t}async function T(n){let{metadataCache:e,vault:t}=window.app,s=y.normalizePath(n);if(s==="/")return Promise.resolve(["",null]);try{let o=e.getFirstLinkpathDest(s,""),r=await t.cachedRead(o),l=window.app.foldManager.load(o);return[r,l]}catch(o){return console.error(`Failed to read the daily note template '${s}'`,o),new y.Notice("Failed to read the daily note template"),["",null]}}function S(n,e="day"){let t=n.clone().startOf(e).format();return`${e}-${t}`}function we(n){return n.replace(/\[[^\]]*\]/g,"")}function lt(n,e){if(e==="week"){let t=we(n);return/w{1,2}/i.test(t)&&(/M{1,4}/.test(t)||/D{1,4}/.test(t))}return!1}function D(n,e){return Pe(n.basename,e)}function ct(n,e){return Pe(it(n),e)}function Pe(n,e){let s={day:L,week:M,month:U,quarter:_,year:H}[e]().format.split("/").pop(),o=window.moment(n,s,!0);if(!o.isValid())return null;if(lt(s,e)&&e==="week"){let r=we(s);if(/w{1,2}/i.test(r))return window.moment(n,s.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return o}var Ce=class extends Error{};async function Se(n){let e=window.app,{vault:t}=e,s=window.moment,{template:o,format:r,folder:l}=L(),[c,d]=await T(o),u=n.format(r),i=await Y(l,u);try{let a=await t.create(i,c.replace(/{{\s*date\s*}}/gi,u).replace(/{{\s*time\s*}}/gi,s().format("HH:mm")).replace(/{{\s*title\s*}}/gi,u).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(p,b,C,f,h,m)=>{let N=s(),I=n.clone().set({hour:N.get("hour"),minute:N.get("minute"),second:N.get("second")});return C&&I.add(parseInt(f,10),h),m?I.format(m.substring(1).trim()):I.format(r)}).replace(/{{\s*yesterday\s*}}/gi,n.clone().subtract(1,"day").format(r)).replace(/{{\s*tomorrow\s*}}/gi,n.clone().add(1,"d").format(r)));return e.foldManager.save(a,d),a}catch(a){console.error(`Failed to create file: '${i}'`,a),new y.Notice("Unable to create new file.")}}function ut(n,e){return e[S(n,"day")]??null}function dt(){let{vault:n}=window.app,{folder:e}=L(),t=n.getAbstractFileByPath(y.normalizePath(e));if(!t)throw new Ce("Failed to find daily notes folder");let s={};return y.Vault.recurseChildren(t,o=>{if(o instanceof y.TFile){let r=D(o,"day");if(r){let l=S(r,"day");s[l]=o}}}),s}var Fe=class extends Error{};function pt(){let{moment:n}=window,e=n.localeData()._week.dow,t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)t.push(t.shift()),e--;return t}function gt(n){return pt().indexOf(n.toLowerCase())}async function Ne(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=M(),[r,l]=await T(t),c=n.format(s),d=await Y(o,c);try{let u=await e.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(i,a,p,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return p&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(i,a,p)=>{let b=gt(a);return n.weekday(b).format(p.trim())}));return window.app.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new y.Notice("Unable to create new file.")}}function ht(n,e){return e[S(n,"week")]??null}function mt(){let n={};if(!Oe())return n;let{vault:e}=window.app,{folder:t}=M(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new Fe("Failed to find weekly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let r=D(o,"week");if(r){let l=S(r,"week");n[l]=o}}}),n}var Ee=class extends Error{};async function ve(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=U(),[r,l]=await T(t),c=n.format(s),d=await Y(o,c);try{let u=await e.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(i,a,p,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return p&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new y.Notice("Unable to create new file.")}}function ft(n,e){return e[S(n,"month")]??null}function yt(){let n={};if(!xe())return n;let{vault:e}=window.app,{folder:t}=U(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new Ee("Failed to find monthly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let r=D(o,"month");if(r){let l=S(r,"month");n[l]=o}}}),n}var Te=class extends Error{};async function bt(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=_(),[r,l]=await T(t),c=n.format(s),d=await Y(o,c);try{let u=await e.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(i,a,p,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return p&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new y.Notice("Unable to create new file.")}}function wt(n,e){return e[S(n,"quarter")]??null}function Pt(){let n={};if(!Ae())return n;let{vault:e}=window.app,{folder:t}=_(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new Te("Failed to find quarterly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let r=D(o,"quarter");if(r){let l=S(r,"quarter");n[l]=o}}}),n}var De=class extends Error{};async function Ct(n){let{vault:e}=window.app,{template:t,format:s,folder:o}=H(),[r,l]=await T(t),c=n.format(s),d=await Y(o,c);try{let u=await e.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(i,a,p,b,C,f)=>{let h=window.moment(),m=n.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return p&&m.add(parseInt(b,10),C),f?m.format(f.substring(1).trim()):m.format(s)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new y.Notice("Unable to create new file.")}}function St(n,e){return e[S(n,"year")]??null}function Ft(){let n={};if(!qe())return n;let{vault:e}=window.app,{folder:t}=H(),s=e.getAbstractFileByPath(y.normalizePath(t));if(!s)throw new De("Failed to find yearly notes folder");return y.Vault.recurseChildren(s,o=>{if(o instanceof y.TFile){let r=D(o,"year");if(r){let l=S(r,"year");n[l]=o}}}),n}function Nt(){let{app:n}=window,e=n.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let t=n.plugins.getPlugin("periodic-notes");return t&&t.settings?.daily?.enabled}function Oe(){let{app:n}=window;if(n.plugins.getPlugin("calendar"))return!0;let e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.weekly?.enabled}function xe(){let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.monthly?.enabled}function Ae(){let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.quarterly?.enabled}function qe(){let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&e.settings?.yearly?.enabled}function Et(n){return{day:L,week:M,month:U,quarter:_,year:H}[n]()}function vt(n,e){return{day:Se,month:ve,week:Ne}[n](e)}g.DEFAULT_DAILY_NOTE_FORMAT=oe;g.DEFAULT_MONTHLY_NOTE_FORMAT=me;g.DEFAULT_QUARTERLY_NOTE_FORMAT=fe;g.DEFAULT_WEEKLY_NOTE_FORMAT=re;g.DEFAULT_YEARLY_NOTE_FORMAT=ye;g.appHasDailyNotesPluginLoaded=Nt;g.appHasMonthlyNotesPluginLoaded=xe;g.appHasQuarterlyNotesPluginLoaded=Ae;g.appHasWeeklyNotesPluginLoaded=Oe;g.appHasYearlyNotesPluginLoaded=qe;g.createDailyNote=Se;g.createMonthlyNote=ve;g.createPeriodicNote=vt;g.createQuarterlyNote=bt;g.createWeeklyNote=Ne;g.createYearlyNote=Ct;g.getAllDailyNotes=dt;g.getAllMonthlyNotes=yt;g.getAllQuarterlyNotes=Pt;g.getAllWeeklyNotes=mt;g.getAllYearlyNotes=Ft;g.getDailyNote=ut;g.getDailyNoteSettings=L;g.getDateFromFile=D;g.getDateFromPath=ct;g.getDateUID=S;g.getMonthlyNote=ft;g.getMonthlyNoteSettings=U;g.getPeriodicNoteSettings=Et;g.getQuarterlyNote=wt;g.getQuarterlyNoteSettings=_;g.getTemplateInfo=T;g.getWeeklyNote=ht;g.getWeeklyNoteSettings=M;g.getYearlyNote=St;g.getYearlyNoteSettings=H});var Le=G((tn,$e)=>{var O=1e3,x=O*60,A=x*60,v=A*24,qt=v*7,kt=v*365.25;$e.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return It(n);if(t==="number"&&isFinite(n))return e.long?$t(n):Rt(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function It(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!!e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*kt;case"weeks":case"week":case"w":return t*qt;case"days":case"day":case"d":return t*v;case"hours":case"hour":case"hrs":case"hr":case"h":return t*A;case"minutes":case"minute":case"mins":case"min":case"m":return t*x;case"seconds":case"second":case"secs":case"sec":case"s":return t*O;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Rt(n){var e=Math.abs(n);return e>=v?Math.round(n/v)+"d":e>=A?Math.round(n/A)+"h":e>=x?Math.round(n/x)+"m":e>=O?Math.round(n/O)+"s":n+"ms"}function $t(n){var e=Math.abs(n);return e>=v?Z(n,e,v,"day"):e>=A?Z(n,e,A,"hour"):e>=x?Z(n,e,x,"minute"):e>=O?Z(n,e,O,"second"):n+" ms"}function Z(n,e,t,s){var o=e>=t*1.5;return Math.round(n/t)+" "+s+(o?"s":"")}});var Ue=G((nn,Me)=>{function Lt(n){t.debug=t,t.default=t,t.coerce=d,t.disable=r,t.enable=o,t.enabled=l,t.humanize=Le(),t.destroy=u,Object.keys(n).forEach(i=>{t[i]=n[i]}),t.names=[],t.skips=[],t.formatters={};function e(i){let a=0;for(let p=0;p<i.length;p++)a=(a<<5)-a+i.charCodeAt(p),a|=0;return t.colors[Math.abs(a)%t.colors.length]}t.selectColor=e;function t(i){let a,p=null,b,C;function f(...h){if(!f.enabled)return;let m=f,N=Number(new Date),I=N-(a||N);m.diff=I,m.prev=a,m.curr=N,a=N,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let B=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(se,Ke)=>{if(se==="%%")return"%";B++;let ge=t.formatters[Ke];if(typeof ge=="function"){let Ze=h[B];se=ge.call(m,Ze),h.splice(B,1),B--}return se}),t.formatArgs.call(m,h),(m.log||t.log).apply(m,h)}return f.namespace=i,f.useColors=t.useColors(),f.color=t.selectColor(i),f.extend=s,f.destroy=t.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(b!==t.namespaces&&(b=t.namespaces,C=t.enabled(i)),C),set:h=>{p=h}}),typeof t.init=="function"&&t.init(f),f}function s(i,a){let p=t(this.namespace+(typeof a=="undefined"?":":a)+i);return p.log=this.log,p}function o(i){t.save(i),t.namespaces=i,t.names=[],t.skips=[];let a,p=(typeof i=="string"?i:"").split(/[\s,]+/),b=p.length;for(a=0;a<b;a++)!p[a]||(i=p[a].replace(/\*/g,".*?"),i[0]==="-"?t.skips.push(new RegExp("^"+i.slice(1)+"$")):t.names.push(new RegExp("^"+i+"$")))}function r(){let i=[...t.names.map(c),...t.skips.map(c).map(a=>"-"+a)].join(",");return t.enable(""),i}function l(i){if(i[i.length-1]==="*")return!0;let a,p;for(a=0,p=t.skips.length;a<p;a++)if(t.skips[a].test(i))return!1;for(a=0,p=t.names.length;a<p;a++)if(t.names[a].test(i))return!0;return!1}function c(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}function d(i){return i instanceof Error?i.stack||i.message:i}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Me.exports=Lt});var ae=G((P,X)=>{P.formatArgs=Ut;P.save=_t;P.load=Ht;P.useColors=Mt;P.storage=Yt();P.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Mt(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ut(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+X.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,s=0;n[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(s=t))}),n.splice(s,0,e)}P.log=console.debug||console.log||(()=>{});function _t(n){try{n?P.storage.setItem("debug",n):P.storage.removeItem("debug")}catch(e){}}function Ht(){let n;try{n=P.storage.getItem("debug")}catch(e){}return!n&&typeof process!="undefined"&&"env"in process&&(n=process.env.DEBUG),n}function Yt(){try{return localStorage}catch(n){}}X.exports=Ue()(P);var{formatters:jt}=X.exports;jt.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});ot(exports,{default:()=>pe});var W=R(require("obsidian")),k=R(ke());var Ie=R(require("obsidian")),K=class extends Ie.Modal{constructor(e,t){super(e);this.config=t;let{cta:s,onAccept:o,text:r,title:l}=t;this.contentEl.createEl("h2",{text:l}),this.contentEl.createEl("p",{text:r}),this.contentEl.createEl("button",{text:"Never mind"}).addEventListener("click",()=>{this.close()}),this.contentEl.createEl("button",{cls:"mod-cta",text:s}).addEventListener("click",async c=>{this.accepted=!0,this.close(),setTimeout(()=>o(c),20)})}onClose(){var e,t;this.accepted||(t=(e=this.config).onCancel)==null||t.call(e)}};var F=R(require("obsidian")),Tt="## Pinboard",Dt=30*60,Ot="pinboard/",xt="Username:SecretTokenCode",At=20,Re=Object.freeze({apiToken:xt,hasAcceptedDisclaimer:!1,latestSyncTime:0,isSyncEnabled:!1,syncInterval:Dt,sectionHeading:Tt,tagPrefix:Ot,newlineSeparator:!1,recentCount:At}),ie=class extends F.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){this.containerEl.empty(),this.containerEl.createEl("h3",{text:"Pinboard"}),this.addApiTokenSetting(),this.containerEl.createEl("h3",{text:"Format"}),this.addSectionHeadingSetting(),this.addTagPrefixSetting(),this.addNewlineSeparatorSetting(),this.containerEl.createEl("h3",{text:"Sync"}),this.addSyncEnabledSetting(),this.addSyncIntervalSetting(),this.addRecentCountSetting()}addApiTokenSetting(){new F.Setting(this.containerEl).setName("Token").setDesc("Pinboard API Token").addText(e=>{e.setValue(this.plugin.settings.apiToken),e.onChange(async t=>{let s=t.trim();this.plugin.writeSettings({apiToken:s})})})}addRecentCountSetting(){new F.Setting(this.containerEl).setName("Recent Posts").setDesc("Number of recent posts the plugin will read to sync").addText(e=>{e.setValue(String(this.plugin.settings.recentCount)),e.inputEl.type="number",e.inputEl.onblur=t=>{let s=Number(t.target.value);e.setValue(String(s)),this.plugin.writeSettings({recentCount:s})}})}addSectionHeadingSetting(){new F.Setting(this.containerEl).setName("Section heading").setDesc("Markdown heading to use when adding the Pinboard links to a daily note").addText(e=>{e.setValue(this.plugin.settings.sectionHeading),e.onChange(async t=>{let s=t.trim();this.plugin.writeSettings({sectionHeading:s})})})}addSyncEnabledSetting(){new F.Setting(this.containerEl).setName("Enable periodic syncing").addToggle(e=>{e.setValue(this.plugin.settings.isSyncEnabled),e.onChange(async t=>{this.plugin.writeSettings({isSyncEnabled:t})})})}addSyncIntervalSetting(){new F.Setting(this.containerEl).setName("Sync Frequency").setDesc("Number of seconds the plugin will wait before syncing again").addText(e=>{e.setValue(String(this.plugin.settings.syncInterval)),e.inputEl.type="number",e.inputEl.onblur=t=>{let s=Number(t.target.value);e.setValue(String(s)),this.plugin.writeSettings({syncInterval:s})}})}addTagPrefixSetting(){new F.Setting(this.containerEl).setName("Tag Prefix").setDesc("Prefix added to Pinboard tags when imported into Obsidian (e.g. #pinboard/work)").addText(e=>{e.setValue(this.plugin.settings.tagPrefix),e.onChange(async t=>{this.plugin.writeSettings({tagPrefix:t})})})}addNewlineSeparatorSetting(){new F.Setting(this.containerEl).setName("Use new line as separator").setDesc("Use a new line (instead of a space) to separate url, description and tags").addToggle(e=>{e.setValue(this.plugin.settings.newlineSeparator),e.onChange(async t=>{this.plugin.writeSettings({newlineSeparator:t})})})}};var Qt=require("http"),Vt=require("https"),zt=ae(),_e=zt("shr"),w=class{constructor(e){this.name=e.noEncodeName?e.name:encodeURIComponent(e.name),this.value=e.noEncodeValue?e.value:encodeURIComponent(e.value)}clone(){return new w({name:this.name,value:this.value,noEncodeName:!0,noEncodeValue:!0})}},q=class{constructor(e){this.host=e.host,this.basePath=e.basePath,this.protocol=typeof e.protocol!="undefined"?e.protocol:"https:",this.port=typeof e.port!="undefined"?e.port:443,this.parseJson=typeof e.parseJson!="undefined"?e.parseJson:!1,this.queryParams=typeof e.queryParams!="undefined"?e.queryParams:[],this.method=typeof e.method!="undefined"?e.method:"GET",this.postData=typeof e.postData!="undefined"?e.postData:""}get path(){return`/${this.basePath.join("/")}${this.urlParametersString}`}get urlParametersString(){let e="";return this.queryParams.forEach(t=>{e.length===0?e+="?":e+="&",e+=`${t.name}=${t.value}`}),e}get fullUrl(){return`${this.protocol}//${this.host}:${this.port}${this.path}`}clone(e){let t=new q({host:this.host,basePath:[],protocol:this.protocol,port:this.port,parseJson:this.parseJson,queryParams:[],method:this.method,postData:this.postData});return this.basePath.forEach(s=>t.basePath.push(s)),this.queryParams.forEach(s=>t.queryParams.push(s.clone())),e&&e.subPath&&e.subPath.forEach(s=>t.basePath.push(s)),e&&e.appendQueryParams&&e.appendQueryParams.forEach(s=>t.queryParams.push(s.clone())),t}equals(e){return this.path===e.path&&this.parseJson===e.parseJson&&this.method===e.method&&this.postData===e.postData}get nodeRequestOpts(){return{host:this.host,path:this.path,protocol:this.protocol,port:this.port,method:this.method}}},j=class{req(e){return _e(`${e.method} ${e.fullUrl}`),new Promise((t,s)=>{let o=!1,r=e.nodeRequestOpts,l=[],c;if(e.protocol==="https:")c=Vt.request(r);else if(e.protocol==="http:")c=Qt.request(r);else throw new Error(`Unknown protocol ${e.protocol}`);c.on("response",d=>{d.statusCode?(d.statusCode<200||d.statusCode>=300)&&(o=!0):_e("Got a response from the webserver that has no .statusCode property"),d.on("data",u=>l.push(u)),d.on("end",()=>{let u=Buffer.concat(l).toString(),i,a;if(a=u,o)i=new Error(`ERROR ${d.statusCode} when attempting to ${e.method} '${e.fullUrl}'\r
${u}`);else if(e.parseJson)try{a=JSON.parse(u)}catch(p){i=new Error(`JSON Parse error: ${p} when receiving code ${d.statusCode} after performing ${e.method} on '${e.fullUrl}' and attempting to parse body:\r
${u}`)}i?s(i):t(a)})}),c.on("error",d=>s(d)),e.postData&&c.write(e.postData),c.end()})}};var Wt=ae(),Q=Wt("pbsdk"),E=class{static boolean(e){if(e==="yes"||e==="true"||e===1)return!0;if(e==="no"||e==="false"||e===0)return!1;throw`Unable to parse '${e}'`}static dateFormatter(e){return e.toISOString()}},le=class{constructor(e,t){this.name=e;t&&(this.count=t)}},ee=class{constructor(e,t,s,o,r,l,c,d,u=[]){this.href=e;this.description=t;this.extended=s;this.meta=o;this.hash=r;this.time=l;this.shared=c;this.toread=d;this.tags=u}static fromObj(e){let t=new ee(e.href,e.description,e.extended,e.meta,e.hash,new Date(e.time),E.boolean(e.shared),E.boolean(e.toread));return e.tags.split(" ").forEach(s=>t.tags.push(new le(s))),t}uiString(){let e=[];this.tags.forEach(s=>e.push(s.name));let t="";return t+=`----------------
`,t+=this.description?`${this.description}
`:`UNTITLED BOOKMARK
`,t+=`<${this.href}>
`,t+=this.extended?`${this.extended}
`:"",t+=`bookmarked: ${E.dateFormatter(this.time)}
`,t+=`public: ${this.shared}, toread: ${this.toread}
`,t+=`tags: ${e.join(" ")}
`,t+=`----------------
`,t}},V=class{constructor(e,t,s=[]){this.date=e;this.user=t;this.posts=s}uiString(){let e=`PinboardPostCollection for user ${this.user} on ${E.dateFormatter(this.date)}
`;return e+=`================

`,this.posts.forEach(t=>e+=`${t.uiString()}
`),e+=`================
`,e}static fromHttpResponse(e){let t=new V(new Date(e.date),e.user);return e.posts.forEach(s=>t.posts.push(ee.fromObj(s))),Q(`Got a PostCollection with ${t.posts.length} posts`),t}},z=class{constructor(e,t,s,o,r,l){this.id=e;this.title=t;this.createDate=s;this.updateDate=o;this.hash=r;this.text=l}static fromHttpResponse(e){return new z(e.id,e.title,new Date(e.created_at),new Date(e.updated_at),e.text?e.text:"",e.hash)}},He=class{constructor(e,t){this.note=e;this.post=t}uiString(){let e=[];this.post.tags.forEach(s=>e.push(s.name));let t="";return t+=`----------------
`,t+=`Note: ${this.note.title} (id ${this.note.id}
`,t+=`${this.note.text}
`,t+=`added: ${E.dateFormatter(this.note.createDate)} `,t+=`updated: ${E.dateFormatter(this.note.updateDate)}
`,t+=`public: ${this.post.shared}`,t+=`tags: ${e.join(" ")}
`,t+=`----------------
`,t}},Ye=class{constructor(e,t=new j){this.request=t;this.noun="posts";this.urlOpts=e.clone({subPath:[this.noun]})}update(){let e=this.urlOpts.clone({subPath:["update"]});return this.request.req(e).then(t=>(Q(`Last update time: ${t.update_time}`),new Date(t.update_time)))}get(e=[],t,s,o=!1){if(e.length>3)throw"Only three tags are supported for this request";let r=this.urlOpts.clone({subPath:["get"]});return e.forEach(l=>{r.queryParams.push(new w({name:"tag",value:l}))}),t&&r.queryParams.push(new w({name:"dt",value:E.dateFormatter(t)})),s&&r.queryParams.push(new w({name:"url",value:s})),r.queryParams.push(new w({name:"meta",value:o?"yes":"no"})),this.request.req(r).then(l=>V.fromHttpResponse(l))}recent(e=[],t){if(e.length>3)throw"Only three tags are supported for this request";if(typeof t!="undefined"&&(t>100||t<0))throw`Invalid value for 'count': '${t}'. Must be between 0-100.`;let s=this.urlOpts.clone({subPath:["recent"]});return e.forEach(o=>{s.queryParams.push(new w({name:"tag",value:o}))}),t&&s.queryParams.push(new w({name:"count",value:String(t)})),this.request.req(s).then(o=>V.fromHttpResponse(o))}},je=class{constructor(e,t=new j){this.request=t;this.noun="tags";this.urlOpts=e.clone({subPath:[this.noun]})}get(){let e=this.urlOpts.clone({subPath:["get"]});return this.request.req(e).then(t=>{let s=[];for(let o in t)s.push(new le(o,t[o]));return Q(`Got ${s.length} tags`),s})}rename(e,t){let s=this.urlOpts.clone({subPath:["rename"]});return s.queryParams.push(new w({name:"old",value:e})),s.queryParams.push(new w({name:"new",value:t})),this.request.req(s).then(o=>(Q(`Got result: ${o}`),o))}},Qe=class{constructor(e,t=new j){this.request=t;this.noun="notes";this.urlOpts=e.clone({subPath:[this.noun]})}list(){let e=this.urlOpts.clone({subPath:["list"]});return this.request.req(e).then(t=>{let s=[];return t.notes.forEach(o=>s.push(z.fromHttpResponse(o))),s})}get(e){if(e.length<1)throw"An empty string is an invalid noteid.";let t=this.urlOpts.clone({subPath:[e]});return this.request.req(t).then(s=>z.fromHttpResponse(s))}},Ve=class{constructor(e,t,s){this.notesEndpoint=e;this.postsEndpoint=t;this.notesUrlOpts=s}postFromNote(e){let t=this.notesUrlOpts.clone({subPath:[e.id]}).fullUrl;return this.postsEndpoint.get(void 0,void 0,t).then(s=>{if(s.posts.length!=1)throw`Expected to find bookmark for URL ${t}, but found ${s.posts.length} instead.`;return new He(e,s.posts[0])})}list(){return this.notesEndpoint.list().then(e=>{let t=[];return e.forEach(s=>t.push(this.get(s.id))),Promise.all(t)})}get(e){return this.notesEndpoint.get(e).then(t=>this.postFromNote(t))}},te=class{constructor(e,t){this.user=e;this.secret=t;if(e.length<1||t.length<1)throw"Invalid API token string"}toString(){return`${this.user}${te.separator}${this.secret}`}static fromString(e){let t=e.split(this.separator),[s,o]=t;if(t.length!=2)throw"Invalid API token string";return new te(s,o)}},ce=te;ce.separator=":";var ue=class{constructor(e,t=new q({host:"api.pinboard.in",basePath:["v1"]}),s=new q({host:"notes.pinboard.in",basePath:[]})){this.baseUrlOpts=t;this.notesUrlOpts=s;this.apiToken=ce.fromString(e),this.baseUrlOpts.queryParams.push(new w({name:"auth_token",value:this.apiToken.toString(),noEncodeValue:!0}),new w({name:"format",value:"json"})),this.baseUrlOpts.parseJson=!0,this.notesUrlOpts.basePath.push(`u:${this.apiToken.user}`),this.posts=new Ye(this.baseUrlOpts),this.tags=new je(this.baseUrlOpts),this.notes=new Qe(this.baseUrlOpts),this.notePosts=new Ve(this.notes,this.posts,this.notesUrlOpts),Q(`Pinboard object for user ${this.apiToken.user} set up`)}};var ze=R(require("obsidian"));function We(n,e){let t=null;return n.workspace.iterateAllLeaves(s=>{s.view instanceof ze.MarkdownView&&s.view.file===e&&(t=s.view.sourceMode.cmEditor)}),t}function ne(n=""){let e=n.match(/^(#{1,6})\s+\S/);return e?e[1].length:null}function Be(n,e){return n?"	":"".padStart(e," ")}function Je(n,e){return n.reduce((t,s)=>{let o=e(s);return t[o]=t[o]||[],t[o].push(s),t},{})}async function Ge(n,e,t,s){let o=ne(t),{vault:r}=n,c=(await r.read(e)).split(`
`),d=-1,u=-1;for(let a=0;a<c.length;a++)if(c[a].trim()===t)d=a;else if(d!==-1){let p=ne(c[a]);if(p&&p<=o){u=a;break}}let i=We(n,e);if(i)if(d!==-1){let a={line:d,ch:0},p=u!==-1?{line:u-1,ch:0}:{line:c.length,ch:0};i.replaceRange(`${s}
`,a,p);return}else{let a={line:c.length-1,ch:0};i.replaceRange(`

${s}`,a,a);return}if(d!==-1){let a=c.slice(0,d),p=u!==-1?c.slice(u):[];return r.modify(e,[...a,s,...p].join(`
`))}else return r.modify(e,[...c,"",s].join(`
`))}var de=class{constructor(e,t){this.app=e,this.settings=t,this.renderPin=this.renderPin.bind(this)}renderPin(e){let t=this.app.vault,s=Be(t.getConfig("useTab"),t.getConfig("tabSize")),o=this.settings.tagPrefix,r=[];e.tags.forEach(i=>r.push(i.name));let l=r.filter(i=>!!i).map(i=>i.replace(/\s+/g,"-").toLowerCase()).map(i=>`#${o}${i}`).join(" "),c=e.extended,d=this.settings.newlineSeparator?`
  `:" ";return`- [${e.description}](${e.href})${d}${c}${d}${l}`.trimEnd()}render(e){let{sectionHeading:t}=this.settings,s=ne(t),o=[t];return o.push(...e.map(this.renderPin)),o.join(`
`)}};var pe=class extends W.Plugin{async onload(){console.log("[Pinboard] loading plugin"),this.scheduleNextSync=this.scheduleNextSync.bind(this),this.syncPinboard=this.syncPinboard.bind(this),this.tryToScheduleSync=this.tryToScheduleSync.bind(this),this.tryToSyncPinboard=this.tryToSyncPinboard.bind(this),this.addCommand({id:"pinboard-sync-cmd",name:"Sync",callback:()=>setTimeout(this.tryToSyncPinboard,20)}),await this.loadSettings(),this.settingsTab=new ie(this.app,this),this.addSettingTab(this.settingsTab),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onunload(){console.log("[Pinboard] unloading plugin")}async onLayoutReady(){this.settings.hasAcceptedDisclaimer&&this.settings.isSyncEnabled&&this.scheduleNextSync()}async tryToSyncPinboard(){this.settings.hasAcceptedDisclaimer?this.syncPinboard():new K(this.app,{cta:"Sync",onAccept:async()=>{await this.writeSettings({hasAcceptedDisclaimer:!0}),this.syncPinboard()},text:"Enabling sync will backfill your recent Pinboard into Obsidian. This means potentially creating or modifying hundreds of notes. Make sure to test the plugin in a test vault before continuing.",title:"Sync Now?"}).open()}async tryToScheduleSync(){this.settings.hasAcceptedDisclaimer?this.scheduleNextSync():new K(this.app,{cta:"Sync",onAccept:async()=>{await this.writeSettings({hasAcceptedDisclaimer:!0}),this.scheduleNextSync()},onCancel:async()=>{await this.writeSettings({isSyncEnabled:!1}),this.settingsTab.display()},text:"Enabling sync will backfill your recent Pinboard into Obsidian. This means potentially creating or modifying hundreds of notes. Make sure to test the plugin in a test vault before continuing.",title:"Sync Now?"}).open()}async getPostsFromPinboard(e,t){let s=new ue(t.apiToken),o=r=>{console.log(`API error: ${r}`)};return s.posts.recent([],t.recentCount)}async syncPinboard(){let e=new de(this.app,this.settings),t=(0,k.getAllDailyNotes)(),s=this.settings.latestSyncTime||0,o=[];try{o=await this.getPostsFromPinboard(s,this.settings)}catch(l){new W.Notice("[Pinboard Sync] failed"),console.log(l);return}let r=Je(o.posts.filter(l=>l.time),l=>window.moment(l.time).startOf("day").format());for(let[l,c]of Object.entries(r)){let d=window.moment(l),u=(0,k.getDailyNote)(d,t);u||(u=await(0,k.createDailyNote)(d)),await Ge(this.app,u,this.settings.sectionHeading,e.render(c))}new W.Notice("[Pinboard Sync] complete"),this.writeSettings({latestSyncTime:window.moment().unix()}),this.scheduleNextSync()}cancelScheduledSync(){this.syncTimeoutId!==void 0&&window.clearTimeout(this.syncTimeoutId)}scheduleNextSync(){let e=window.moment().unix();if(this.cancelScheduledSync(),!this.settings.isSyncEnabled||!this.settings.syncInterval){console.log("[Pinboard] scheduling skipped, no syncInterval set");return}let{latestSyncTime:t,syncInterval:s}=this.settings,o=s*1e3,r=Math.max(t+o-e,20);console.log(`[Pinboard] next sync scheduled in ${r}ms`),this.syncTimeoutId=window.setTimeout(this.syncPinboard,r)}async loadSettings(){this.settings=Object.assign({},Re,await this.loadData()),this.settings.hasAcceptedDisclaimer||(this.settings.isSyncEnabled=!1)}async writeSettings(e){this.settings=Object.assign(this.settings,e),e.isSyncEnabled!==void 0?e.isSyncEnabled?this.tryToScheduleSync():this.cancelScheduledSync():e.syncInterval!==void 0&&this.settings.isSyncEnabled&&this.tryToScheduleSync(),await this.saveData(this.settings)}};0&&(module.exports={});
